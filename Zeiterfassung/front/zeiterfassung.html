<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Michael Becker</title>
    <meta name="viewport" content="width=device-width, initial-scale=5.0" />
    <link rel="stylesheet" type="text/css" media="screen" href="zeiterfassung.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    
    <script>
    function calculateWorkTime(start, end) {
        
        var startTime = new Date("1970-01-01 " + start);
        var endTime = new Date("1970-01-01 " + end);

        
        var diff = endTime - startTime;

       
        var hours = Math.floor(diff / 1000 / 60 / 60);
        var minutes = Math.floor(diff / 1000 / 60) % 60;

        
        return hours + ":" + (minutes < 10 ? "0" : "") + minutes;
    }
    function calculatePause(workTime) {
        
        var workTimeParts = workTime.split(":");
        var workTimeInMinutes = parseInt(workTimeParts[0]) * 60 + parseInt(workTimeParts[1]);

        
        if (workTimeInMinutes < 6 * 60) {
            return "0:00";
        } else if (workTimeInMinutes < 9 * 60) {
            return "0:30";
        } else {
            return "0:45";
        }
    }
      function addRow() {
          var start = document.getElementById("start").value;
          var end = document.getElementById("end").value;

          
          var newTimeRecord = {
              start: start,
              end: end
          };

          
          fetch('/timeRecords', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify(newTimeRecord),
          })
          .then(response => response.json())
          .then(data => {
              // Add the new time record to the table
              var table = document.getElementById("timeTable");
              var row = table.insertRow(-1);
              row.dataset.id = data.id;
              var dateCell = row.insertCell(0);
              var startCell = row.insertCell(1);
              var endCell = row.insertCell(2);
              var workTimeCell = row.insertCell(3);
              var pauseCell = row.insertCell(4);
              var actionCell = row.insertCell(5);
              dateCell.innerHTML = new Date().toLocaleDateString();
              startCell.innerHTML = start;
              endCell.innerHTML = end;
              workTimeCell.innerHTML = calculateWorkTime(start, end);
              pauseCell.innerHTML = calculatePause(calculateWorkTime(start, end));
              actionCell.innerHTML = '<button class = "deleteButton" button onclick="deleteRow(this, ' + data.id + ')">Delete</button>';
          })
          .catch((error) => {
              console.error('Error:', error);
          });
      }

      function deleteRow(btn) {
         // Get the ID of the time record to delete
          var id = btn.parentNode.parentNode.dataset.id;

          // Send a DELETE request to the server
          fetch('/timeRecords/' + id, {
              method: 'DELETE',
          })
          .then((response) => {
              if (!response.ok) {
                  throw new Error('Network response was not ok');
              }
              // Remove the row from the table
              var row = btn.parentNode.parentNode;
              row.parentNode.removeChild(row);
          })
          .catch((error) => {
              console.error('Error:', error);
          });
      }
      window.onload = function() {
        fetch('/timeRecords')
        .then(response => response.json())
        .then(data => {
            data.forEach(record => {
                var table = document.getElementById("timeTable");
                var row = table.insertRow(-1);
                row.dataset.id = record.id;
                var dateCell = row.insertCell(0);
                var startCell = row.insertCell(1);
                var endCell = row.insertCell(2);
                var worktimeCell = row.insertCell(3);
                var pauseCell = row.insertCell(4);
                var actionCell = row.insertCell(5);
                dateCell.innerHTML = new Date().toLocaleDateString();
                startCell.innerHTML = record.start;
                endCell.innerHTML = record.end;
                worktimeCell.innerHTML = calculateWorkTime(record.start, record.end);
                pauseCell.innerHTML = calculatePause(calculateWorkTime(record.start, record.end));
                actionCell.innerHTML = '<button class = "deleteButton" button onclick="deleteRow(this, ' + data.id + ')">Delete</button>';
            });
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
    </script>
  </head>

  <body>
    <header>
    <div class = "container">
        <h1>Zeitmanagement</h1>
        <a href="overview.html" class="home-button"><i class="fas fa-home"></i></a>
        
    </div>
    </header>
    <main>
        <div class ="container2">
            <form id="timeForm">
                <label for="start">Startzeit:</label>
                <input type="time" id="start" name="start">
                <label for="end">Endzeit:</label>
                <input type="time" id="end" name="end">
                <button type="button" onclick="addRow()">Add</button>
            </form>
        
        
            <table id="timeTable">
                <tr>
                    <th>Datum</th>
                    <th>Startzeit</th>
                    <th>Endzeit</th>
                    <th>Arbeitszeit</th>
                    <th>Pause</th>
                    <th>Aktion</th>
                </tr>
            </table>
        </div>
  </main>
    <footer>
        <div class="container">
            <p>&copy; 2024 Reutlinger Coding Team</p>
        </div>
    </footer>
  </body>
</html>